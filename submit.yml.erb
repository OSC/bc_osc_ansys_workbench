<%-
  num_nodes = bc_num_slots.blank? ? 1 : bc_num_slots.to_i
  num_cpus_for_free = 4

  if node_type == ':hugemem'
    num_cpus_per_node_requested = 48
  else
    num_cpus_per_node_requested = num_cores.blank? ? 28 : num_cores.to_i
    num_cpus_per_node_requested = [num_cpus_per_node_requested, 28].min
  end

  num_cpus_needing_license = (num_nodes * num_cpus_per_node_requested) - num_cpus_for_free
  # Do not attempt to reserve negative CPUs
  ansys_par_request = (reserve_parallel_licenses.to_i == 1 && num_cpus_needing_license > 0) ? "\%ansyspar+#{num_cpus_needing_license}" : ""
  software_request = "ansys+1" + ansys_par_request

  ppn = (num_cpus_per_node_requested > 0) ? ":ppn=#{num_cpus_per_node_requested}" : ""
-%>
---
batch_connect:
  template: "vnc"
script:
  native:
    resources:
      nodes: "<%= num_nodes %><%= ppn %><%= node_type %>"
      software: "<%= software_request %>"

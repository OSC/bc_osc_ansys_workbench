#!/usr/bin/env ruby

env_var = ENV['SLURM_JOB_NODELIST'].to_s
procs = ENV['SLURM_NPROCS'].to_i

match = env_var.match('(?<cluster>\w)\[(?<start_node>\d{4})-(?<end_node>\d{4})\]')

if !match.nil?
  start_node = match['start_node'].to_i
  cluster = match['cluster']
  nodes = match['end_node'].to_i - start_node

  node_list = (0..nodes).map do |node|
                formatted = sprintf('%04d', start_node + node)
                "#{cluster}#{formatted}"
              end

  # puts node_list.inspect

  list = node_list.map do |node|
    procs.times.map { |_| node }
  end
  puts list
else
  puts procs.times.map { |_| env_var }.join("\n")
end
